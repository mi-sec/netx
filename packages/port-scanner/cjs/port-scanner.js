!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("@mi-sec/lightmap")):"function"==typeof define&&define.amd?define(["@mi-sec/lightmap"],n):"object"==typeof exports?exports["port-scanner"]=n(require("@mi-sec/lightmap")):e["port-scanner"]=n(e["@mi-sec/lightmap"])}(global,(function(e){return function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=2)}([function(e,n){e.exports=require("net")},function(n,t){n.exports=e},function(e,n,t){"use strict";t.r(n),t.d(n,"commonPorts",(function(){return p})),t.d(n,"convertHighResolutionTime",(function(){return i})),t.d(n,"connect",(function(){return u})),t.d(n,"scan",(function(){return c}));var o=t(0),r=t.n(o),s=t(1);const p=new(t.n(s).a)([[7,"echo"],[9,"discard"],[13,"daytime"],[21,"ftp"],[22,"ssh"],[23,"telnet"],[25,"smtp"],[26,"rsftp"],[37,"time"],[53,"domain"],[79,"finger"],[80,"http"],[81,"hosts2-ns"],[88,"kerberos-sec"],[106,"pop3pw"],[110,"pop3"],[111,"rpcbind"],[113,"ident"],[119,"nntp"],[135,"msrpc"],[139,"netbios-ssn"],[143,"imap"],[144,"news"],[179,"bgp"],[199,"smux"],[389,"ldap"],[427,"svrloc"],[443,"https"],[444,"snpp"],[445,"microsoft-ds"],[465,"smtps"],[513,"login"],[514,"shell"],[515,"printer"],[543,"klogin"],[544,"kshell"],[548,"afp"],[554,"rtsp"],[587,"submission"],[631,"ipp"],[646,"ldp"],[873,"rsync"],[990,"ftps"],[993,"imaps"],[995,"pop3s"],[1025,"NFS-or-IIS"],[1026,"LSA-or-nterm"],[1027,"IIS"],[1028,"unknown"],[1029,"ms-lsa"],[1110,"nfsd-status"],[1433,"ms-sql-s"],[1720,"h323q931"],[1723,"pptp"],[1755,"wms"],[1900,"upnp"],[2e3,"cisco-sccp"],[2001,"dc"],[2049,"nfs"],[2121,"ccproxy-ftp"],[2717,"pn-requester"],[3e3,"ppp"],[3128,"squid-http"],[3306,"mysql"],[3389,"ms-wbt-server"],[3986,"unknown"],[4899,"radmin"],[5e3,"upnp"],[5009,"airport-admin"],[5051,"ida-agent"],[5060,"sip"],[5101,"admdog"],[5190,"aol"],[5357,"wsdapi"],[5432,"postgresql"],[5631,"unknown"],[5666,"nrpe"],[5800,"vnc-http"],[5900,"vnc"],[6e3,"X11"],[6001,"X11:1"],[6646,"unknown"],[7070,"realserver"],[8e3,"http-alt"],[8008,"http"],[8009,"ajp13"],[8080,"http-proxy"],[8081,"blackice-icecap"],[8443,"https-alt"],[8888,"unknown"],[9100,"jetdirect"],[9999,"abyss"],[1e4,"unknown"],[32768,"filenet-tms"],[49152,"unknown"],[49153,"unknown"],[49154,"unknown"],[49155,"unknown"],[49156,"unknown"],[49157,"unknown"]]);function i(e){return(1e9*e[0]+e[1])/1e6}function u(e,n,t={}){return!t.debug||console.log(`scanning ${e}:${n}`),new Promise((o,s)=>{const u=t.timeout||1e3;let c="",l="",a=null,d=!1,f=process.hrtime();const m=r.a.createConnection({port:n,host:e});m.on("connect",()=>{const o=process.hrtime(f);f=i(o),!t.debug||console.log(`${e}:${n} connected in ${f}ms`),l="open",m.end()}),m.on("data",e=>{t.bannerGrab&&(c=e.toString()),m.end()}),m.setTimeout(u),m.on("timeout",()=>{!t.debug||console.log(`${e}:${n} timeout`),l="closed",a=new Error("timeout"),m.end()}),m.on("error",o=>{!t.debug||console.log(`${e}:${n} error`),l="closed","ECONNREFUSED"!==o.code?a=o:d=!0}),m.on("close",r=>{if(t.onlyReportOpen&&"open"!==l)return o();const i={host:e,port:n,status:l};"open"===l&&(i.banner=c,i.time=f,t.attemptToIdentify&&(i.service=p.get(n)||"unknown")),a=r&&!d?a||r:null,a?(!t.debug||console.log(`${e}:${n} error`),i.error=a,s(i)):o(i)})})}async function c(e={}){e.host=e.host||"127.0.0.1",e.port=e.port?Array.isArray(e.port)?e.port:[e.port]:[...p.keys()],e.timeout=e.timeout||500,e.debug=!!e.hasOwnProperty("debug")&&e.debug,e.onlyReportOpen=!e.hasOwnProperty("onlyReportOpen")||e.onlyReportOpen,e.bannerGrab=!e.hasOwnProperty("bannerGrab")||e.bannerGrab,e.attemptToIdentify=!e.hasOwnProperty("attemptToIdentify")||e.attemptToIdentify,!e.debug||console.log("starting scan with options"),!e.debug||console.log("  host: "+e.host),!e.debug||console.log("  ports: "+e.port),!e.debug||console.log("  timeout: "+e.timeout),!e.debug||console.log("  debug: "+e.debug),!e.debug||console.log("  onlyReportOpen: "+e.onlyReportOpen),!e.debug||console.log("  bannerGrab: "+e.bannerGrab),!e.debug||console.log("  attemptToIdentify: "+e.attemptToIdentify);let n=[];for(let t=0;t<e.port.length;t++)n.push(u(e.host,e.port[t],e));return n=await Promise.all(n),n=n.filter(e=>!!e),n}n.default=c}])}));